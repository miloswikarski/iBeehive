<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>iBeehive</title>
  <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <link rel="stylesheet" href="css/iot-theme-bundle.min.css">

  <script src="cordova.js"></script>          <!-- "Phantom" cordova.js required for projects that use plugins -->
  <script src="bower_components/jquery/dist/jquery.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="bower_components/i18next/i18next.min.js"></script>
  <script src="bower_components/jquery-i18next/jquery-i18next.min.js"></script>
  <script type="text/javascript" src="js/fastclick.js"></script>
  <script src="js/jquery.knob.min.js" type="text/javascript"></script>
  <script src="js/pouchdb-6.4.1.min.js" type="text/javascript"></script>


  <!-- Custom -->
  <link rel="stylesheet" type="text/css" href="css/font-awesome.min.css" />
  <link rel="stylesheet" type="text/css" href="css/base.css" />

</head>
<body>



  <div class="container"><!-- all pages -->


    <!-- menu -->
    <nav class="navbar navbar-collapse navbar-dark fixed-top bg-dark">
      <a class="navbar-brand" href="#"><img  style="max-width:50px;" src="css/icon.png"> iBeehive</a>

      <button class="navbar-toggler collapsed" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="navbar-collapse collapse" id="navbarCollapse">
        <ul class="navbar-nav mr-auto">
          <li class="text-center">
            <button class="btn btn-warning" data-toggle="collapse" data-target=".navbar-collapse.show"  id="refreshButton" type="button">
              <i class="fa fa-undo"></i> <span data-i18n="rescan">Rescan...</span>
            </button>
          </li>
          <li>
                &nbsp;
          </li>
          <li>
                <div class="card-body d-flex w-100 justify-content-between">
                <input  id="messageInput" class="form-control mr-sm-2" type="text" placeholder="Data to send..." aria-label="Search">
                <button id="sendButton" class="btn btn-outline-success my-2 my-sm-0">Send</button>
                </div>
          </li>
          <li class="text-center">
                <button id="settingsButton" class="btn btn-success" data-toggle="collapse" data-target=".navbar-collapse.show"><i class="fa fa-cogs"></i> <span data-i18n="settings">Settings</span></button>
          <li>
                &nbsp;
          </li>

          </li>
          <li class="text-center">
                <button id="aboutButton" class="btn btn-primary" data-toggle="collapse" data-target=".navbar-collapse.show"><i class="fa fa-info-circle"></i> <span data-i18n="aboutIbeehive">About iBeehive</span></button>
          </li>
          <li>
                &nbsp;
          </li>


        </ul>
      </div>
    </nav>


    <!-- status info -->
    <div class="row col-lg-12"><label id="mainStatus">Initializing...</label></div>


    <!-- init scanning page -->

    <div class="row" id="notFoundInfo">
      <div class="col-lg-12">
        <h2 data-i18n="scanning">Scanning... not found yet</h2>
        <p data-i18n="iBeehiveIntro">iBeehive app is searching for all smart bluetooth devices around you. If you are near iBeehive device, you will be able to connect to this device and see actual and historical data.</p>
      </div>
    </div>

    <div id="mainPage">
      <div class="row col-lg-12"><h4 id="iFound" data-i18n="bleFound">Bluetooth device(s) found!</h4></div>
      <div id="deviceList">                    
      </div>
    </div>

    <!-- detail -->

    <div id="detailPage" class="">
      <div id="resultDiv" class="row"></div>

      <div class="card bg-white justify-content-between">
      <div class="card-header row">
        <span class="col-sm-12 text-primary" id="detailName"></span>
<!--        <span class="fa-stack fa-lg float-right col-sm-1" id="linked">
        <i class="fa fa-link text-success"></i>
        </span> -->
      </div>
      <div class="card-body row text-secondary">
<!--        <h2 class="float-left"  id="nettoVahaTitle"></h2> -->
        <span class="fa-stack fa-1x float-right col-sm-1">
        <i class="fa fa-balance-scale text-right"></i>
        </span>
        <h1 class="text-left col-sm-10" id="nettoVaha">
                    <div class="loader"></div>
        </h1>
        <div class="progress d-flex w-100">
          <div id="weightProgress" class="progress-bar progress-bar-striped progress-bar-animated text-success" role="progressbar" aria-valuenow="79" aria-valuemin="0" aria-valuemax="300" style="width: 79%">79% max</div>
        </div>

      </div>
      <div class="card-body row">
        <span class="fa-stack fa-lg col-sm-1 text-primary">
        <i class="fa fa-thermometer-half"></i>
        </span>
      <div class="col-sm-5 text-primary">
        <span class="float-left"  id="tempInTitle"></span>
        <H1 class="float-right" id="tempIn">
          <div class="loader"></div>
        </H1>
      </div>
      <span class="fa-stack fa-lg col-sm-1 text-success">
        <i class="fa fa-thermometer-full"></i>
        </span>
      <div class="col-sm-5 text-success">
        <span class="float-left"  id="tempOutTitle"></span>
        <H1 class="float-right text-success" id="tempOut">
                    <div class="loader"></div>
        </H1>
      </div>
      </div>


      </div>


      <div class="card bg-white">
      <div class="card-body row">
      <canvas id="weightChart" class="col-sm-6 mh-150"></canvas>
      <canvas id="tempChart" class="col-sm-6 mh-150"></canvas>
      </div>
      </div>


      <!-- SAVE AND DISCONNECT BTNS -->

    <div class="wrapper text-center">

      <div>&nbsp;</div>


      <div class="btn-group" role="group" aria-label="iBeehive actions">

      <button id="disconnectButton" class="btn btn-success"><i class="fa fa-unlink"></i> <span data-i18n="disconnect">Disconnect</span></button>

      <button id="saveButton" class="btn btn-primary" data-toggle="modal" data-target="#infoModal"><i class="fa fa-archive"></i> <span data-i18n="save">Save</span></button>

      <button id="historyButton" class="btn btn-secondary" data-toggle="modal" data-target="#historyModal"><i class="fa fa-history"></i> <span data-i18n="history">History</span></button>

      </div>
    </div>


      <!-- Save alert dialog box -->

      <!-- Modal -->
      <div class="modal fade modal-fullscreen" id="historyModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel" data-i18n="historyValues">History values</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body" id="historyBody">
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal" data-i18n="close">Close</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Modal INFO -->
      <div class="modal fade" id="infoModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="infoModalLabel" data-i18n="actualValues">Actual values</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body" data-i18n="valuesSaved">
              Actual values saved
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal" data-i18n="close">Close</button>
            </div>
          </div>
        </div>
      </div>


      <!-- Modal ABOUT -->
      <div class="modal fade modal-fullscreen" id="aboutModal" tabindex="-1" role="dialog" aria-labelledby="About iBeehive" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="aboutTitle" data-i18n="aboutTitle">About iBeehive</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body" id="aboutBody">
              <span data-i18n="aboutText"> iBeehive is application used for smart bee weight products by Alya Ltd. You can find more on </span>
               <a href="https://www.alya.sk">www.alya.sk</a>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal" data-i18n="close">Close</button>
            </div>
          </div>
        </div>
      </div>


      <!-- Modal SETTINGS -->
      <div class="modal fade modal-fullscreen" id="settingsModal" tabindex="-1" role="dialog" aria-labelledby="About iBeehive" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="settingsTitle" data-i18n="settings">Settings</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body" id="settingsBody">
              <ul class="list-group list-group-flush">
                    <li class="list-group-item d-flex active" data-unit="switch-light-1">
                      <svg class="icon-sprite">
                        <use class="glow" fill="url(#radial-glow)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="assets/images/icons-sprite.svg#glow"></use>
                        <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="assets/images/icons-sprite.svg#bulb-eco"></use>
                      </svg>
                      <h5>Show DEMO card</h5>
                      <label class="switch ml-auto checked">
                        <input type="checkbox" id="switch-light-1" checked="">
                      </label>
                      <div class="info-holder info-rb" style="right:40px;">
                        <div data-toggle="popover-all" data-content="Checkbox element using localStorage to remember the last status." data-original-title="Switch ON/OFF" data-container="body" data-placement="top" data-offset="0,-6"></div>
                      </div>
                    </li>
                    <li class="list-group-item d-flex" data-unit="switch-light-2">
                      <svg class="icon-sprite">
                        <use class="glow" fill="url(#radial-glow)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="assets/images/icons-sprite.svg#glow"></use>
                        <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="assets/images/icons-sprite.svg#bulb-eco"></use>
                      </svg>
                      <h5>Show all devices</h5>
                      <label class="switch ml-auto">
                        <input type="checkbox" id="switch-light-2">
                      </label>
                    </li>
                    <li class="list-group-item d-flex" data-unit="switch-light-3">
                      <svg class="icon-sprite">
                        <use class="glow" fill="url(#radial-glow)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="assets/images/icons-sprite.svg#glow"></use>
                        <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="assets/images/icons-sprite.svg#bulb-eco"></use>
                      </svg>
                      <h5>Automatic sync with cloud</h5>
                      <label class="switch ml-auto">
                        <input type="checkbox" id="switch-light-3">
                      </label>
                    </li>
                    <li class="list-group-item d-flex" data-unit="switch-light-4">
                      <svg class="icon-sprite">
                        <use class="glow" fill="url(#radial-glow)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="assets/images/icons-sprite.svg#glow"></use>
                        <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="assets/images/icons-sprite.svg#bulb-eco"></use>
                      </svg>
                      <h5>Show graphs</h5>
                      <label class="switch ml-auto">
                        <input type="checkbox" id="switch-light-4">
                      </label>
                    </li>
                    <li class="list-group-item d-flex" data-unit="switch-light-5">
                      <svg class="icon-sprite">
                        <use class="glow" fill="url(#radial-glow)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="assets/images/icons-sprite.svg#glow"></use>
                        <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="assets/images/icons-sprite.svg#bulb-eco"></use>
                      </svg>
                      <h5>Show history table</h5>
                      <label class="switch ml-auto">
                        <input type="checkbox" id="switch-light-5">
                      </label>
                    </li>
                  </ul>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal" data-i18n="close">Close</button>
            </div>
          </div>
        </div>
      </div>



      <div id="dataDiv">&nbsp;</div>
    </div>


  </div>


  <script type="text/javascript" src="js/Chart.bundle.min.js"></script>
  <script type="text/javascript" src="js/iot-functions.min.js"></script>
  <script type="text/javascript" src="js/dbapp.js"></script>
  <script type="text/javascript" src="js/app.js"></script>
  <script type="text/javascript" src="js/index.js"></script>
  <script type="text/javascript">
    app.initialize();
    beedb.initialize();
  </script>


  <script>
    $(document).ready(function() {


      // Get checkbox statuses from localStorage if available (IE)
      if (localStorage) {

        // Menu minifier status (Contract/expand side menu on large screens)
        var checkboxValue = localStorage.getItem('minifier');

        if (checkboxValue === 'true') {
          $('#sidebar,#menu-minifier').addClass('mini');
          $('#minifier').prop('checked', true);

        } else {

          if ($('#minifier').is(':checked')) {
            $('#sidebar,#menu-minifier').addClass('mini');
            $('#minifier').prop('checked', true);
          } else {
            $('#sidebar,#menu-minifier').removeClass('mini');
            $('#minifier').prop('checked', false);
          }
        }

        // Switch statuses
        var switchValues = JSON.parse(localStorage.getItem('switchValues')) || {};

        $.each(switchValues, function(key, value) {

          // Apply only if element is included on the page
          if ($('[data-unit="' + key + '"]').length) {

            if (value === true) {

              // Apply appearance of the "unit" and checkbox element
              $('[data-unit="' + key + '"]').addClass("active");
              $("#" + key).prop('checked', true);
              $("#" + key).closest("label").addClass("checked");

              //In case of Camera unit - play video
              if (key === "switch-camera-1" || key === "switch-camera-2") {
                $('[data-unit="' + key + '"] video')[0].play();
              }

            } else {
              $('[data-unit="' + key + '"]').removeClass("active");
              $("#" + key).prop('checked', false);
              $("#" + key).closest("label").removeClass("checked");
              if (key === "switch-camera-1" || key === "switch-camera-2") {
                $('[data-unit="' + key + '"] video')[0].pause();
              }
            }
          }
        });
      }


      // Contract/expand side menu on click. (only large screens)
      $('#minifier').click(function() {

        $('#sidebar,#menu-minifier').toggleClass('mini');

        // Save side menu status to localStorage if available (IE)
        if (localStorage) {
          checkboxValue = this.checked;
          localStorage.setItem('minifier', checkboxValue);
        }

      });


      // Side menu toogler for medium and small screens
      $('[data-toggle="offcanvas"]').click(function() {
        $('.row-offcanvas').toggleClass('active');
      });


      // Switch (checkbox element) toogler
      $('.switch input[type="checkbox"]').on("change", function(t) {

        // Check the time between changes to prevert Android native browser execute twice
        // If you dont need support for Android native browser - just call "switchSingle" function
        if (this.last) {

          this.diff = t.timeStamp - this.last;

          // Don't execute if the time between changes is too short (less than 250ms) - Android native browser "twice bug"
          // The real time between two human taps/clicks is usually much more than 250ms"
          if (this.diff > 250) {

            this.last = t.timeStamp;

            iot.switchSingle(this.id, this.checked);

          } else {
            return false;
          }

        } else {

          // First attempt on this switch element
          this.last = t.timeStamp;

          iot.switchSingle(this.id, this.checked);

        }
      });

      // All ON/OFF controls
      $('.lights-control').click(function() {

        var target = $(this).closest('.lights-controls').data('controls');
        var action = $(this).data('action');

        iot.switchGroup(target, action);
      });

      // Reposition to center when a modal is shown
      $('.modal.centered').on('show.bs.modal', iot.centerModal);

      // Reset/Stop countdown timer (EXIT NOW)
      $('#armModal').on('hide.bs.modal', iot.clearCountdown);

      // Garage doors controls
      $('.doors-control').click(function() {

        var target = $(this).closest('.timer-controls').data('controls');
        var action = $(this).data('action');

        iot.garageDoors(target, action);
      });

      // Alerts "Close" callback - hide modal and alert indicator dot when user closes all alerts
      $('#alertsModal .alert').on('close.bs.alert', function() {
        var sum = $('#alerts-toggler').attr('data-alerts');
        sum = sum - 1;
        $('#alerts-toggler').attr('data-alerts', sum);

        if (sum === 0) {
          $('#alertsModal').modal('hide');
          $('#alerts-toggler').attr('data-toggle', 'none');

        }

      });

      // Show/hide tips (popovers) - FAB button (right bottom on large screens)
      $('#info-toggler').click(function() {

        if ($('body').hasClass('info-active')) {
          $('[data-toggle="popover-all"]').popover('hide');
          $('body').removeClass('info-active');
        } else {
          $('[data-toggle="popover-all"]').popover('show');
          $('body').addClass('info-active');
        }
      });

      // Hide tips (popovers) by clicking outside
      $('body').on('click', function(pop) {

        if (pop.target.id !== 'info-toggler' && $('body').hasClass('info-active')) {
          $('[data-toggle="popover-all"]').popover('hide');
          $('body').removeClass('info-active');
        }

      });

    });

    // Apply necessary changes, functionality when content is loaded
    $(window).on('load', function() {

      // This script is necessary for cross browsers icon sprite support (IE9+, ...) 
      svg4everybody();

      // Washing machine - demonstration of running program/cycle
      $('#wash-machine').timer({
        countdown: true,
        format: '%H:%M:%S',
        duration: '1h17m10s',
        callback: function() {
          $('[data-unit="wash-machine"]').removeClass("active");
        }
      });

      if ($('[data-unit="switch-camera-1"]').hasClass("active")) {
        var activeVideo = $('[data-unit="switch-camera-1"] video').get(0);

        if (activeVideo.paused) {
          activeVideo.autoplay = true;
          activeVideo.load();
          activeVideo.play();
        } else {
          activeVideo.pause();
        }
      }

      if ($('[data-unit="switch-camera-2"]').hasClass("active")) {
        var activeVideo = $('[data-unit="switch-camera-2"] video').get(0);

        if (activeVideo.paused) {
          activeVideo.autoplay = true;
          activeVideo.load();
          activeVideo.play();
        } else {
          activeVideo.pause();
        }
      }

      // "Timeout" function is not neccessary - important is to hide the preloader overlay
      setTimeout(function() {

        // Hide preloader overlay when content is loaded
        $('#iot-preloader,.card-preloader').fadeOut();
        $("#wrapper").removeClass("hidden");

        // Check for Main contents scrollbar visibility and set right position for FAB button
        iot.positionFab();

      }, 800);

    });

    // Apply necessary changes if window resized
    $(window).on('resize', function() {

      // Modal reposition when the window is resized
      $('.modal.centered:visible').each(iot.centerModal);

      // Check for Main contents scrollbar visibility and set right position for FAB button
      iot.positionFab();
    });

  </script>

</body>
</html>
